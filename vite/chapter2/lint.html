<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>代码规范：利用lint工具 | RE 的学习小站</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="对 Javascript 学习的记录总结">
    
    <link rel="preload" href="/yg-notes/assets/css/0.styles.0edbbd45.css" as="style"><link rel="preload" href="/yg-notes/assets/js/app.2e7302dd.js" as="script"><link rel="preload" href="/yg-notes/assets/js/2.7fcefaab.js" as="script"><link rel="preload" href="/yg-notes/assets/js/27.b302be54.js" as="script"><link rel="prefetch" href="/yg-notes/assets/js/10.f0dc12ab.js"><link rel="prefetch" href="/yg-notes/assets/js/11.9214686f.js"><link rel="prefetch" href="/yg-notes/assets/js/12.edcbbd05.js"><link rel="prefetch" href="/yg-notes/assets/js/13.ae2d6b27.js"><link rel="prefetch" href="/yg-notes/assets/js/14.6b1063de.js"><link rel="prefetch" href="/yg-notes/assets/js/15.e439c0bc.js"><link rel="prefetch" href="/yg-notes/assets/js/16.3958f30d.js"><link rel="prefetch" href="/yg-notes/assets/js/17.ace37177.js"><link rel="prefetch" href="/yg-notes/assets/js/18.ffee9195.js"><link rel="prefetch" href="/yg-notes/assets/js/19.8208740c.js"><link rel="prefetch" href="/yg-notes/assets/js/20.2851c64d.js"><link rel="prefetch" href="/yg-notes/assets/js/21.1790c4cf.js"><link rel="prefetch" href="/yg-notes/assets/js/22.2e134e6e.js"><link rel="prefetch" href="/yg-notes/assets/js/23.f6ab81a0.js"><link rel="prefetch" href="/yg-notes/assets/js/24.1d2bd70b.js"><link rel="prefetch" href="/yg-notes/assets/js/25.183a5c16.js"><link rel="prefetch" href="/yg-notes/assets/js/26.05d86e9f.js"><link rel="prefetch" href="/yg-notes/assets/js/28.6d819659.js"><link rel="prefetch" href="/yg-notes/assets/js/29.602d90d2.js"><link rel="prefetch" href="/yg-notes/assets/js/3.2d6fd0ee.js"><link rel="prefetch" href="/yg-notes/assets/js/30.29f035a4.js"><link rel="prefetch" href="/yg-notes/assets/js/31.778b5459.js"><link rel="prefetch" href="/yg-notes/assets/js/4.4623a818.js"><link rel="prefetch" href="/yg-notes/assets/js/5.89eafe95.js"><link rel="prefetch" href="/yg-notes/assets/js/6.0a121ed3.js"><link rel="prefetch" href="/yg-notes/assets/js/7.484f9988.js"><link rel="prefetch" href="/yg-notes/assets/js/8.89b2441f.js"><link rel="prefetch" href="/yg-notes/assets/js/9.47bbfd45.js">
    <link rel="stylesheet" href="/yg-notes/assets/css/0.styles.0edbbd45.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/yg-notes/" class="home-link router-link-active"><!----> <span class="site-name">RE 的学习小站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/yg-notes/jsbase/chapter1/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/yg-notes/css/chapter1/" class="nav-link">
  CSS
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yg-notes/vue3/chapter1/" class="nav-link">
  vue3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="books" class="dropdown-title"><span class="title">books</span> <span class="arrow down"></span></button> <button type="button" aria-label="books" class="mobile-dropdown-title"><span class="title">books</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yg-notes/books/vuejs/chapter1/" class="nav-link">
  vue.js 设计与实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="compile Menu" class="dropdown-title"><span class="title">compile</span> <span class="arrow down"></span></button> <button type="button" aria-label="compile Menu" class="mobile-dropdown-title"><span class="title">compile</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yg-notes/compiler/chapter1/" class="nav-link">
  Compiler
</a></li><li class="dropdown-item"><!----> <a href="/yg-notes/vite/chapter1/" class="nav-link">
  vite小册
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="algorithm Menu" class="dropdown-title"><span class="title">algorithm</span> <span class="arrow down"></span></button> <button type="button" aria-label="algorithm Menu" class="mobile-dropdown-title"><span class="title">algorithm</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yg-notes/algorithm/chapter1/" class="nav-link">
  algorithm
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/yg-notes/jsbase/chapter1/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/yg-notes/css/chapter1/" class="nav-link">
  CSS
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="vue" class="dropdown-title"><span class="title">vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="vue" class="mobile-dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yg-notes/vue3/chapter1/" class="nav-link">
  vue3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="books" class="dropdown-title"><span class="title">books</span> <span class="arrow down"></span></button> <button type="button" aria-label="books" class="mobile-dropdown-title"><span class="title">books</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yg-notes/books/vuejs/chapter1/" class="nav-link">
  vue.js 设计与实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="compile Menu" class="dropdown-title"><span class="title">compile</span> <span class="arrow down"></span></button> <button type="button" aria-label="compile Menu" class="mobile-dropdown-title"><span class="title">compile</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yg-notes/compiler/chapter1/" class="nav-link">
  Compiler
</a></li><li class="dropdown-item"><!----> <a href="/yg-notes/vite/chapter1/" class="nav-link">
  vite小册
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="algorithm Menu" class="dropdown-title"><span class="title">algorithm</span> <span class="arrow down"></span></button> <button type="button" aria-label="algorithm Menu" class="mobile-dropdown-title"><span class="title">algorithm</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/yg-notes/algorithm/chapter1/" class="nav-link">
  algorithm
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vite 小册</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yg-notes/vite/chapter1/" class="sidebar-link">module standard</a></li><li><a href="/yg-notes/vite/chapter1/quick-start.html" class="sidebar-link">quick-start</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vite-project-framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yg-notes/vite/chapter2/" aria-current="page" class="sidebar-link">vite中接入 css</a></li><li><a href="/yg-notes/vite/chapter2/lint.html" aria-current="page" class="active sidebar-link">代码规范：利用lint工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yg-notes/vite/chapter2/lint.html#js-ts-规范工具-eslint" class="sidebar-link">JS/TS 规范工具: ESLint</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yg-notes/vite/chapter2/lint.html#初始化" class="sidebar-link">初始化</a></li><li class="sidebar-sub-header"><a href="/yg-notes/vite/chapter2/lint.html#核心配置解读" class="sidebar-link">核心配置解读</a></li><li class="sidebar-sub-header"><a href="/yg-notes/vite/chapter2/lint.html#与-prettier-强强联合" class="sidebar-link">与 Prettier 强强联合</a></li></ul></li><li class="sidebar-sub-header"><a href="/yg-notes/vite/chapter2/lint.html#在-vite-中接入-eslint" class="sidebar-link">在 Vite 中接入 ESLint</a></li><li class="sidebar-sub-header"><a href="/yg-notes/vite/chapter2/lint.html#样式规范工具-stylelint" class="sidebar-link">样式规范工具: Stylelint</a></li><li class="sidebar-sub-header"><a href="/yg-notes/vite/chapter2/lint.html#husky-lint-staged-的-git-提交工作流集成" class="sidebar-link">Husky + lint-staged 的 Git 提交工作流集成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yg-notes/vite/chapter2/lint.html#提交前的代码-lint-检查" class="sidebar-link">提交前的代码 Lint 检查</a></li><li class="sidebar-sub-header"><a href="/yg-notes/vite/chapter2/lint.html#提交时的-commit-信息规范" class="sidebar-link">提交时的 commit 信息规范</a></li></ul></li><li class="sidebar-sub-header"><a href="/yg-notes/vite/chapter2/lint.html#小结" class="sidebar-link">小结</a></li></ul></li><li><a href="/yg-notes/vite/chapter2/assets.html" class="sidebar-link">vite 中处理各种静态资源</a></li><li><a href="/yg-notes/vite/chapter2/pre-bundling.html" class="sidebar-link">依赖预构建</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>双引擎架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yg-notes/vite/chapter3/" class="sidebar-link">Esbuild</a></li><li><a href="/yg-notes/vite/chapter3/esbuild-plugin.html" class="sidebar-link">Esbuld plugin</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="代码规范-利用lint工具"><a href="#代码规范-利用lint工具" class="header-anchor">#</a> 代码规范：利用lint工具</h1> <blockquote><p>代码不仅是让机器看的，它也是给人看的。</p></blockquote> <p>在真实的工程项目中，尤其是多人协作的场景下，代码规范就变得非常重要了，它可以用来统一团队代码风格，避免不同风格的代码混杂到一起难以阅读，有效<strong>提高代码质量</strong>，甚至可以将一些<strong>语法错误</strong>在开发阶段提前规避掉。但仅有规范本身不够，我们需要<strong>自动化的工具</strong>(即Lint 工具)来保证规范的落地，把代码规范检查(包括<code>自动修复</code>)这件事情交给机器完成，开发者只需要专注应用逻辑本身。</p> <p>本节，我们将一起来完成 <code>Lint</code> 工具链在项目中的落地，实现自动化代码规范检查及修复的能力。学完本节内容后，你不仅能熟悉诸如<code>ESLint</code>、<code>Prettier</code>、<code>Stylelint</code>和<code>Commitlint</code> 等诸多主流 <code>Lint</code> 工具的概念和使用，还能配合<code>husky</code>、<code>lint-staged</code>、<code>VSCode 插件</code>和<code>Vite</code> 生态在项目中集成完整的 <code>Lint</code> 工具链，搭建起完整的前端开发和代码提交工作流，这部分内容虽然和 <code>Vite</code> 没有直接的联系，但也是 <code>Vite</code> 项目搭建中非常重要的一环，是前端工程化的必备知识。</p> <h2 id="js-ts-规范工具-eslint"><a href="#js-ts-规范工具-eslint" class="header-anchor">#</a> JS/TS 规范工具: ESLint</h2> <blockquote><p>ESLint 是在 ECMAScript/JavaScript 代码中识别和报告模式匹配的工具，它的目标是保证代码的一致性和避免错误。</p></blockquote> <p><code>ESLint</code> 的使用并不复杂，主要通过配置文件对各种代码格式的规则(<code>rules</code>)进行配置，以指定具体的代码规范。目前开源社区也有一些成熟的规范集可供使用，著名的包括<a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener noreferrer">Airbnb JavaScript 代码规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://github.com/standard/standard/blob/master/docs/README-zhcn.md" target="_blank" rel="noopener noreferrer">Standard JavaScript 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://google.github.io/styleguide/jsguide.html" target="_blank" rel="noopener noreferrer">Google JavaScript 规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等等，你可以在项目中直接使用这些成熟的规范，也可以自己定制一套团队独有的代码规范，这在一些大型团队当中还是很常见的。</p> <h3 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h3> <p>接下来我们来利用 ESLint 官方的 cli 在现有的脚手架项目中进行初始化操作，首先我们需要安装 ESLint:</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm i eslint -D
</code></pre></div><p>接着执行 ESLint 的初始化命令，并进行如下的命令行交互:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>npx eslint <span class="token operator">--</span>init
</code></pre></div><img src="/yg-notes/assets/vite/7.webp"> <p>接着 <code>ESLint</code> 会帮我们自动生成<code>.eslintrc.js</code>配置文件。需要注意的是，在上述初始化流程中我们并没有用 npm 安装依赖，需要进行手动安装:</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm i eslint-plugin-react@latest @typescript-eslint/eslint-plugin@latest @typescript-eslint/parser@latest -D
</code></pre></div><h3 id="核心配置解读"><a href="#核心配置解读" class="header-anchor">#</a> 核心配置解读</h3> <p>大家初次接触配置文件可能会有点不太理解，接下来我来为你介绍一下几个核心的配置项，你可以对照目前生成的<code>.eslintrc.js</code>一起学习。</p> <h4 id="_1-parser-解析器"><a href="#_1-parser-解析器" class="header-anchor">#</a> 1. parser - 解析器</h4> <p><code>ESLint</code> 底层默认使用 <a href="https://github.com/eslint/espree" target="_blank" rel="noopener noreferrer">Espree<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来进行 <code>AST</code> 解析，这个解析器目前已经基于 <code>Acron</code> 来实现，虽然说 <code>Acron</code> 目前能够解析绝大多数的 <a href="https://github.com/acornjs/acorn/tree/master/acorn" target="_blank" rel="noopener noreferrer">ECMAScript 规范的语法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，但还是不支持 <code>TypeScript</code> ，因此需要引入其他的解析器完成 TS 的解析。</p> <p>社区提供了<code>@typescript-eslint/parser</code>这个解决方案，专门为了 <code>TypeScript</code> 的解析而诞生，将 <code>TS</code> 代码转换为 <code>Espree</code> 能够识别的格式(即 <a href="https://github.com/estree/estree" target="_blank" rel="noopener noreferrer">Estree 格式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)，然后在 <code>Eslint</code> 下通过<code>Espree</code>进行格式检查， 以此兼容了 <code>TypeScript</code> 语法。</p> <h4 id="_2-parseroptions-解析器选项"><a href="#_2-parseroptions-解析器选项" class="header-anchor">#</a> 2. parserOptions - 解析器选项</h4> <p>这个配置可以对上述的解析器进行能力定制，默认情况下 ESLint 支持 ES5 语法，你可以配置这个选项，具体内容如下:</p> <ul><li><code>ecmaVersion</code>: 这个配置和 <code>Acron</code> 的 <a href="https://github.com/acornjs/acorn/tree/master/acorn" target="_blank" rel="noopener noreferrer">ecmaVersion<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是兼容的，可以配置 <code>ES + 数字</code>(如 ES6)或者<code>ES + 年份</code>(如 ES2015)，也可以直接配置为<code>latest</code>，启用最新的 ES 语法。</li> <li>sourceType: 默认为<code>script</code>，如果使用 <code>ES Module</code> 则应设置为<code>module</code></li> <li>ecmaFeatures: 为一个对象，表示想使用的额外语言特性，如开启 <code>jsx</code>。</li></ul> <h4 id="_3-rules-具体代码规则"><a href="#_3-rules-具体代码规则" class="header-anchor">#</a> 3. rules - 具体代码规则</h4> <p><code>rules</code> 配置即代表在 <code>ESLint</code> 中手动调整哪些代码规则，比如<strong>禁止在 if 语句中使用赋值语句</strong>这条规则可以像如下的方式配置:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 其它配置省略</span>
  rules<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// key 为规则名，value 配置内容</span>
    <span class="token string">&quot;no-cond-assign&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;always&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 <code>rules</code> 对象中，<code>key</code> 一般为规则名，<code>value</code> 为具体的配置内容，在上述的例子中我们设置为一个数组，数组第一项为规则的 <code>ID</code>，第二项为<code>规则的配置</code>。</p> <p>这里重点说一说规则的 ID，它的语法对所有规则都适用，你可以设置以下的值:</p> <ul><li><code>off</code> 或 <code>0</code>: 表示关闭规则。</li> <li><code>warn</code> 或 <code>1</code>: 表示开启规则，不过违背规则后只抛出 <code>warning</code>，而不会导致程序退出。</li> <li><code>error</code> 或 <code>2</code>: 表示开启规则，不过违背规则后抛出 <code>error</code>，程序会退出。</li></ul> <p>具体的规则配置可能会不一样，有的是一个字符串，有的可以配置一个对象，你可以参考 <a href="https://cn.eslint.org/docs/rules/" target="_blank" rel="noopener noreferrer">ESLint 官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>当然，你也能直接将 <code>rules</code> 对象的 <code>value</code> 配置成 <code>ID</code>，如: <code>&quot;no-cond-assign&quot;: &quot;error&quot;</code>。</p> <h4 id="_4-plugins"><a href="#_4-plugins" class="header-anchor">#</a> 4. plugins</h4> <p>上面提到过 <code>ESLint</code> 的 <code>parser</code> 基于<code>Acorn</code>实现，不能直接解析 <code>TypeScript</code>，需要我们指定 <code>parser</code> 选项为<code>@typescript-eslint/parser</code>才能兼容 TS 的解析。同理，ESLint 本身也没有内置 TypeScript 的代码规则，这个时候 ESLint 的插件系统就派上用场了。我们需要通过添加 ESLint 插件来增加一些特定的规则，比如添加<code>@typescript-eslint/eslint-plugin</code> 来拓展一些关于 TS 代码的规则，如下代码所示:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 添加 TS 规则，可省略`eslint-plugin`</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@typescript-eslint'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>值得注意的是，添加插件后只是拓展了 <code>ESLint</code> 本身的规则集，但 <code>ESLint</code> 默认并没有开启这些规则的校验！如果要开启或者调整这些规则，你需要在 <code>rules</code> 中进行配置，如:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 开启一些 TS 规则</span>
  rules<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'@typescript-eslint/ban-ts-comment'</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
    <span class="token string">'@typescript-eslint/no-explicit-any'</span><span class="token operator">:</span> <span class="token string">'warn'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_5-extends-继承配置"><a href="#_5-extends-继承配置" class="header-anchor">#</a> 5. extends - 继承配置</h4> <p>extends 相当于继承另外一份 ESLint 配置，可以配置为一个字符串，也可以配置成一个字符串数组。主要分如下 3 种情况:</p> <ol><li>从 <code>ESLint</code> 本身继承；</li> <li>从类似 <code>eslint-config-xxx</code> 的 <code>npm</code> 包继承；</li> <li>从 <code>ESLint</code> 插件继承。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 第1种情况 </span>
    <span class="token string">&quot;eslint:recommended&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 第2种情况，一般配置的时候可以省略 `eslint-config`</span>
    <span class="token string">&quot;standard&quot;</span>
    <span class="token comment">// 第3种情况，可以省略包名中的 `eslint-plugin`</span>
    <span class="token comment">// 格式一般为: `plugin:${pluginName}/${configName}`</span>
    <span class="token string">&quot;plugin:react/recommended&quot;</span>
    <span class="token string">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>有了 <code>extends</code> 的配置，对于之前所说的 <code>ESLint</code> 插件中的繁多配置，我们就不需要手动一一开启了，通过 <code>extends</code> 字段即可自动开启插件中的推荐规则:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="token punctuation">]</span>
</code></pre></div><h4 id="_6-env-和-globals"><a href="#_6-env-和-globals" class="header-anchor">#</a> 6. env 和 globals</h4> <p>这两个配置分别表示<strong>运行环境</strong>和<strong>全局变量</strong>，在指定的运行环境中会预设一些全局变量，比如:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .eslint.js</span>
module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;env&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;browser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>指定上述的 <code>env</code> 配置后便会启用<code>浏览器</code>和 <code>Node.js</code> 环境，这两个环境中的一些<code>全局变量</code>(如<code>window、global</code> 等)会同时启用。</p> <p>有些全局变量是业务代码引入的第三方库所声明，这里就需要在<code>globals</code>配置中声明全局变量了。每个全局变量的配置值有 3 种情况:</p> <ol><li><code>&quot;writable&quot;</code>或者 <code>true</code>，表示变量可重写；</li> <li><code>&quot;readonly&quot;</code>或者<code>false</code>，表示变量不可重写；</li> <li><code>&quot;off&quot;</code>，表示禁用该全局变量。</li></ol> <p>那<code>jquery</code>举例，我们可以在配置文件中声明如下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;globals&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 不可重写</span>
    <span class="token string">&quot;$&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
    <span class="token string">&quot;jQuery&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>相信有了上述核心配置部分的讲解，你再回头看看初始化生成的 ESLint 配置文件，你也能很好地理解各个配置项的含义了。</p> <h3 id="与-prettier-强强联合"><a href="#与-prettier-强强联合" class="header-anchor">#</a> 与 Prettier 强强联合</h3> <p>虽然 <code>ESLint</code> 本身具备自动格式化代码的功能(eslint --fix)，但术业有专攻，<code>ESLint</code> 的主要优势<strong>在于代码的风格检查</strong>并给出提示，而在代码格式化这一块 <code>Prettier</code> 做的更加专业，因此我们经常将 <code>ESLint</code> 结合 <code>Prettier</code> 一起使用。</p> <p>首先我们来安装一下 Prettier:</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm i prettier -D
</code></pre></div><p>在项目根目录新建<code>.prettierrc.js</code>配置文件，填写如下的配置内容:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .prettierrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  printWidth<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token comment">//一行的字符数，如果超过会进行换行，默认为80</span>
  tabWidth<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 一个 tab 代表几个空格数，默认为 2 个</span>
  useTabs<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//是否使用 tab 进行缩进，默认为false，表示用空格进行缩减</span>
  singleQuote<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 字符串是否使用单引号，默认为 false，使用双引号</span>
  semi<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 行尾是否使用分号，默认为true</span>
  trailingComma<span class="token operator">:</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 是否使用尾逗号</span>
  bracketSpacing<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 对象大括号直接是否有空格，默认为 true，效果：{ a: 1 }</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>接下来我们将<code>Prettier</code>集成到现有的<code>ESLint</code>工具中，首先安装两个工具包:</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm i eslint-config-prettier eslint-plugin-prettier -D
</code></pre></div><p>其中<code>eslint-config-prettier</code>用来覆盖 <code>ESLint</code> 本身的规则配置，而<code>eslint-plugin-prettier</code>则是用于让 <code>Prettier</code> 来接管<code>eslint --fix</code>即修复代码的能力。</p> <p>在 <code>.eslintrc.js</code> 配置文件中接入 <code>prettier</code> 的相关工具链，最终的配置代码如下所示，你可以直接粘贴过去:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  env<span class="token operator">:</span> <span class="token punctuation">{</span>
    browser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    es2021<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;eslint:recommended&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;plugin:react/recommended&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// 1. 接入 prettier 的规则</span>
    <span class="token string">&quot;prettier&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;plugin:prettier/recommended&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  parser<span class="token operator">:</span> <span class="token string">&quot;@typescript-eslint/parser&quot;</span><span class="token punctuation">,</span>
  parserOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    ecmaFeatures<span class="token operator">:</span> <span class="token punctuation">{</span>
      jsx<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ecmaVersion<span class="token operator">:</span> <span class="token string">&quot;latest&quot;</span><span class="token punctuation">,</span>
    sourceType<span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 2. 加入 prettier 的 eslint 插件</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@typescript-eslint&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;prettier&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  rules<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 3. 注意要加上这一句，开启 prettier 自动修复的功能</span>
    <span class="token string">&quot;prettier/prettier&quot;</span><span class="token operator">:</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
    quotes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;single&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    semi<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;always&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;react/react-in-jsx-scope&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>OK，现在我们回到项目中来见证一下<code>ESLint + Prettier</code>强强联合的威力，在 <code>package.json</code> 中定义一个脚本:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 省略已有 script</span>
    <span class="token property">&quot;lint:script&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint --ext .js,.jsx,.ts,.tsx --fix --quiet ./&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来在命令行终端执行:</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm run lint:script
</code></pre></div><p>这样我们就完成了 <code>ESLint</code> 的规则检查以及 <code>Prettier</code> 的自动修复。不过每次执行这个命令未免会有些繁琐，我们可以在<code>VSCode</code>中安装<code>ESLint</code>和<code>Prettier</code>这两个插件，并且在设置区中开启<code>Format On Save</code>:</p> <img src="/yg-notes/assets/vite/8.webp"> <p>接下来在你按Ctrl + S保存代码的时候，Prettier 便会自动帮忙修复代码格式。</p> <h2 id="在-vite-中接入-eslint"><a href="#在-vite-中接入-eslint" class="header-anchor">#</a> 在 Vite 中接入 ESLint</h2> <p>除了安装编辑器插件，我们也可以通过 Vite 插件的方式在开发阶段进行 ESLint 扫描，以命令行的方式展示出代码中的规范问题，并能够直接定位到原文件。</p> <p>首先我们安装 Vite 中的 ESLint 插件:</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm i vite-plugin-eslint -D
</code></pre></div><p>然后在 vite.config.ts 中接入:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// vite.config.ts</span>
<span class="token keyword">import</span> viteEslint <span class="token keyword">from</span> <span class="token string">'vite-plugin-eslint'</span><span class="token punctuation">;</span>

<span class="token comment">// 具体配置</span>
<span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 省略其它插件</span>
    <span class="token function">viteEslint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在你可以试着重新启动项目， ESLint 的错误已经能够及时显示到命令行窗口中了。</p> <img src="/yg-notes/assets/vite/9.webp"> <blockquote><p>由于这个插件采用另一个进程来运行 ESLint 的扫描工作，因此不会影响 Vite 项目的启动速度，这个大家不用担心。</p></blockquote> <h2 id="样式规范工具-stylelint"><a href="#样式规范工具-stylelint" class="header-anchor">#</a> 样式规范工具: Stylelint</h2> <p>接下来我们进入<code>Stylelint</code>的部分，先来看看官方的定义:</p> <blockquote><p>Stylelint，一个强大的现代化样式 Lint 工具，用来帮助你避免语法错误和统一代码风格。</p></blockquote> <p><code>Stylelint</code> 主要专注于样式代码的规范检查，内置了 170 多个 CSS 书写规则，支持 CSS 预处理器(如 <code>Sass</code>、<code>Less</code>)，提供插件化机制以供开发者扩展规则，已经被 Google、Github 等大型团队投入使用。与 ESLint 类似，在规范检查方面，<code>Stylelint</code> 已经做的足够专业，而在代码格式化方面，我们仍然需要结合 <code>Prettier</code> 一起来使用。</p> <p>首先让我们来安装 Stylelint 以及相应的工具套件：</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm i stylelint stylelint-prettier stylelint-config-prettier stylelint-config-recess-order stylelint-config-standard stylelint-config-standard-scss -D
</code></pre></div><p>然后，我们在 <code>Stylelint</code> 的配置文件<code>.stylelintrc.js</code>中一一使用这些工具套件:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .stylelintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 注册 stylelint 的 prettier 插件</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'stylelint-prettier'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 继承一系列规则集合</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// standard 规则集合</span>
    <span class="token string">'stylelint-config-standard'</span><span class="token punctuation">,</span>
    <span class="token comment">// standard 规则集合的 scss 版本</span>
    <span class="token string">'stylelint-config-standard-scss'</span><span class="token punctuation">,</span>
    <span class="token comment">// 样式属性顺序规则</span>
    <span class="token string">'stylelint-config-recess-order'</span><span class="token punctuation">,</span>
    <span class="token comment">// 接入 Prettier 规则</span>
    <span class="token string">'stylelint-config-prettier'</span><span class="token punctuation">,</span>
    <span class="token string">'stylelint-prettier/recommended'</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 配置 rules</span>
  rules<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 开启 Prettier 自动格式化功能</span>
    <span class="token string">'prettier/prettier'</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>可以发现 <code>Stylelint</code> 的配置文件和 <code>ESLint</code> 还是非常相似的，常用的<code>plugins</code>、<code>extends</code>和<code>rules</code>属性在 <code>ESLint</code> 同样存在，并且与 <code>ESLint</code> 中这三个属性的功能也基本相同。不过需要强调的是在 <code>Stylelint</code> 中 <code>rules</code> 的配置会和 <code>ESLint</code> 有些区别，对于每个具体的 rule 会有三种配置方式:</p> <ul><li><code>null</code>，表示关闭规则。</li> <li>一个简单值(如 true，字符串，根据不同规则有所不同)，表示开启规则，但并不做过多的定制。</li> <li>一个数组，包含两个元素，即<code>[简单值，自定义配置]</code>，第一个元素通常为一个简单值，第二个元素用来进行更精细化的规则配置。</li></ul> <p>接下来我们将 <code>Stylelint</code> 集成到项目中，回到 <code>package.json</code> 中，增加如下的 scripts 配置:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 整合 lint 命令</span>
    <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint:script &amp;&amp; npm run lint:style&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// stylelint 命令</span>
    <span class="token property">&quot;lint:style&quot;</span><span class="token operator">:</span> <span class="token string">&quot;stylelint --fix \&quot;src/**/*.{css,scss}\&quot;&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行<code>pnpm run lint:style</code>即可完成样式代码的规范检查和自动格式化。当然，你也可以在 VSCode 中安装<code>Stylelint</code>插件，这样能够在开发阶段即时感知到代码格式问题，提前进行修复。</p> <p>当然，我们也可以直接在 <code>Vite</code> 中集成 <code>Stylelint</code>。社区中提供了 <code>Stylelint</code> 的 Vite 插件，实现在项目开发阶段提前暴露出样式代码的规范问题。我们来安装一下这个插件:</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm i @amatlash/vite-plugin-stylelint -D
</code></pre></div><p>然后在 Vite 配置文件中添加如下的内容:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> viteStylelint <span class="token keyword">from</span> <span class="token string">'@amatlash/vite-plugin-stylelint'</span><span class="token punctuation">;</span>

<span class="token comment">// 具体配置</span>
<span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 省略其它插件</span>
    <span class="token function">viteStylelint</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 对某些文件排除检查</span>
      exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">windicss|node_modules</span><span class="token regex-delimiter">/</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来，你就可以在命令行界面看到对应的 Stylelint 提示了:</p> <img src="/yg-notes/assets/vite/10.webp"> <h2 id="husky-lint-staged-的-git-提交工作流集成"><a href="#husky-lint-staged-的-git-提交工作流集成" class="header-anchor">#</a> Husky + lint-staged 的 Git 提交工作流集成</h2> <h3 id="提交前的代码-lint-检查"><a href="#提交前的代码-lint-检查" class="header-anchor">#</a> 提交前的代码 Lint 检查</h3> <p>在上文中我们提到了安装 <code>ESLint</code>、<code>Prettier</code>和<code>Stylelint</code>的浏览器插件或者 Vite 插件，在开发阶段提前规避掉代码格式的问题，但实际上这也只是将问题提前暴露，并不能保证规范问题能完全被解决，还是可能导致线上的代码出现不符合规范的情况。那么如何来避免这类问题呢？</p> <p>我们可以在代码提交的时候进行卡点检查，也就是拦截 <code>git commit</code> 命令，进行代码格式检查，只有确保通过格式检查才允许正常提交代码。社区中已经有了对应的工具——<code>Husky</code>来完成这件事情，让我们来安装一下这个工具:</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm i husky -D
</code></pre></div><p>值得提醒的是，有很多人推荐在<code>package.json</code>中配置 husky 的钩子:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;husky&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;pre-commit&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run lint&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这种做法在 Husky 4.x 及以下版本没问题，而在最新版本(7.x 版本)中是无效的！在新版 Husky 版本中，我们需要做如下的事情:</p> <ol><li>初始化 <code>Husky: npx husky install</code>，并将 <code>husky install</code>作为项目启动前脚本，如:</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 会在安装 npm 依赖后自动执行</span>
    <span class="token property">&quot;postinstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;husky install&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>添加 Husky 钩子，在终端执行如下命令:</li></ol> <div class="language- extra-class"><pre class="language-text"><code>npx husky add .husky/pre-commit &quot;npm run lint&quot;
</code></pre></div><p>接着你将会在项目根目录的<code>.husky</code>目录中看到名为<code>pre-commit</code>的文件，里面包含了 <code>git commit</code>前要执行的脚本。现在，当你执行 <code>git commit</code> 的时候，会首先执行 <code>npm run lint</code>脚本，通过 Lint 检查后才会正式提交代码记录。</p> <p>不过，刚才我们直接在 <code>Husky</code> 的钩子中执行 <code>npm run lint</code>，这会产生一个额外的问题: <code>Husky</code> 中每次执行<code>npm run lint</code>都对仓库中的代码进行全量检查，也就是说，即使某些文件并没有改动，也会走一次 <code>Lint</code> 检查，当项目代码越来越多的时候，提交的过程会越来越慢，影响开发体验。</p> <p>而<code>lint-staged</code>就是用来解决上述全量扫描问题的，可以实现只对存入<code>暂存区</code>的文件进行 Lint 检查，大大提高了提交代码的效率。首先，让我们安装一下对应的 npm 包:</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm i -D lint-staged
</code></pre></div><p>然后在 <code>package.json</code>中添加如下的配置:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;lint-staged&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;**/*.{js,jsx,tsx,ts,json}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;npm run lint:script&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;git add --force&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;**/*.{scss}&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;npm run lint:style&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;git add --force&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来我们需要在 <code>Husky</code> 中应用<code>lint-stage</code>，回到<code>.husky/pre-commit</code>脚本中，将原来的<code>npm run lint</code>换成如下脚本:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>npx <span class="token operator">--</span>no <span class="token operator">--</span> lint<span class="token operator">-</span>staged
</code></pre></div><p>如此一来，我们便实现了提交代码时的<strong>增量 <code>Lint</code> 检查</strong>。</p> <h3 id="提交时的-commit-信息规范"><a href="#提交时的-commit-信息规范" class="header-anchor">#</a> 提交时的 commit 信息规范</h3> <p>除了代码规范检查之后，Git 提交信息的规范也是不容忽视的一个环节，规范的 commit 信息能够方便团队协作和问题定位。首先我们来安装一下需要的工具库，执行如下的命令:</p> <div class="language- extra-class"><pre class="language-text"><code>pnpm i commitlint @commitlint/cli @commitlint/config-conventional -D
</code></pre></div><p>接下来新建<code>.commitlintrc.js</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// .commitlintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@commitlint/config-conventional&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>一般我们直接使用<code>@commitlint/config-conventional</code>规范集就可以了，它所规定的 <code>commit</code> 信息一般由两个部分: <code>type</code> 和 <code>subject</code> 组成，结构如下:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// type 指提交的类型</span>
<span class="token comment">// subject 指提交的摘要信息</span>
<span class="token operator">&lt;</span>type<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token operator">&lt;</span>subject<span class="token operator">&gt;</span>
</code></pre></div><p>常用的 type 值包括如下:</p> <ul><li><code>feat</code>: 添加新功能。</li> <li><code>fix</code>: 修复 Bug。</li> <li><code>chore</code>: 一些不影响功能的更改。</li> <li><code>docs</code>: 专指文档的修改。</li> <li><code>perf</code>: 性能方面的优化。</li> <li><code>refactor</code>: 代码重构。</li> <li><code>test</code>: 添加一些测试代码等等。</li></ul> <p>接下来我们将<code>commitlint</code>的功能集成到 <code>Husky</code> 的钩子当中，在终端执行如下命令即可:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>npx husky add <span class="token punctuation">.</span>husky<span class="token operator">/</span>commit<span class="token operator">-</span>msg <span class="token string">&quot;npx --no-install commitlint -e $HUSKY_GIT_PARAMS&quot;</span>
</code></pre></div><p>你可以发现在<code>.husky</code>目录下多出了<code>commit-msg</code>脚本文件，表示<code>commitlint</code>命令已经成功接入到 <code>husky</code> 的钩子当中。现在我们可以尝试对代码进行提交，假如输入一个错误的 <code>commit</code> 信息，<code>commitlint</code> 会自动抛出错误并退出:</p> <img src="/yg-notes/assets/vite/11.webp"> <p>至此，我们便完成了 Git 提交信息的卡点扫描和规范检查。</p> <h2 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h2> <p>本小节你应该了解前端的<strong>自动化代码规范工具的使用</strong>以及<strong>在 Vite 中的接入方法</strong>。</p> <p>我主要给你介绍了 3 个方面的自动化代码规范工具:</p> <ol><li>JavaScript/TypeScript 规范。主流的 Lint 工具包括 <code>Eslint</code>、<code>Prettier</code>；</li> <li>样式开发规范。主流的 Lint 工具包括<code>Stylelint</code>、<code>Prettier</code>；</li> <li>Git 提交规范。主流的 Lint 工具包括<code>Commitlint</code>。</li></ol> <p>我们可以通过编辑器的插件或者 Vite 插件在开发阶段暴露出规范问题，但也无法保证这类问题在开发时完全被解决掉，因此我们尝试在代码提交阶段来解决这个问题，通过<code>Husky+lint-staged</code>成功地拦截 <code>git commit</code>过程，只有在各项 Lint 检查通过后才能正常提交代码，这样就有效提高了线上代码和 Git 提交信息的质量。</p> <p>关于样式修复不生效,在 vscode 配置中加上这几行配置即可:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;editor.codeActionsOnSave&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token property">&quot;source.fixAll.stylelint&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token property">&quot;stylelint.validate&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;css&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;less&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;scss&quot;</span><span class="token punctuation">]</span>

</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">4/18/2022, 4:53:26 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yg-notes/vite/chapter2/" class="prev router-link-active">
        vite中接入 css
      </a></span> <span class="next"><a href="/yg-notes/vite/chapter2/assets.html">
        vite 中处理各种静态资源
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/yg-notes/assets/js/app.2e7302dd.js" defer></script><script src="/yg-notes/assets/js/2.7fcefaab.js" defer></script><script src="/yg-notes/assets/js/27.b302be54.js" defer></script>
  </body>
</html>
